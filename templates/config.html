{% extends "layout.html" %}
{% block content %}
<div class="fade-in" style="max-width: 900px; margin: 0 auto;">
    <div style="margin-bottom: 3rem; text-align: center;">
        <h2>Configuration du Projet</h2>
        <p>DÃ©finissez l'ADN visuel et sonore de votre vidÃ©o.</p>
    </div>

    <div class="card">
        <div style="margin-bottom: 2.5rem;">
            <label style="font-size: 1.1rem; margin-bottom: 1rem;">ğŸ’¡ Votre Concept</label>
            <textarea id="idea" placeholder="Ex: Un chef Ã©toilÃ© prÃ©pare un plat signature dans une cuisine futuriste..." style="height: 120px; font-size: 1.1rem;"></textarea>
        </div>

        <div class="config-grid">
            <div>
                <label>ğŸ¨ Style Visuel</label>
                <select id="styleSelect" style="height: 50px;">
                    <option value="realistic_cinematic">ğŸ“¸ RÃ©aliste CinÃ©matique</option>
                    <option value="3d_cartoon">ğŸ§¸ 3D Cartoon (Pixar)</option>
                    <option value="anime_manga">ğŸ—¾ Anime / Manga</option>
                    <option value="illustration_book">ğŸ“š Illustration</option>
                </select>
            </div>

            <div>
                <label>ğŸ¥ Mouvement CamÃ©ra</label>
                <select id="cameraSelect" style="height: 50px;">
                    <option value="cinematic">âœ¨ CinÃ©matique (MÃ©lange doux)</option>
                    <option value="zoom_in">ğŸ” Zoom In (Lent vers l'avant)</option>
                    <option value="zoom_out">ğŸ”™ Zoom Out (DÃ©couverte)</option>
                    <option value="pan_right">â¡ï¸ Panoramique Droite</option>
                    <option value="static">ğŸ—¿ Plan Fixe (TrÃ©pied)</option>
                    <option value="handheld">ğŸ«¨ CamÃ©ra Ã‰paule (Immersion)</option>
                    <option value="drone">ğŸš Vue Drone / AÃ©rienne</option>
                </select>
            </div>

            <div>
                <label>ğŸ‘¤ Genre de la Voix</label>
                <select id="voiceGenderSelect" style="height: 50px;">
                    <option value="male">Homme</option>
                    <option value="female">Femme</option>
                </select>
            </div>
            <div>
                <label>ğŸ™ï¸ Style Vocal</label>
                <select id="voiceVibeSelect" style="height: 50px;">
                    <option value="neutral">Neutre & PosÃ©</option>
                    <option value="epic">Grave & Ã‰pique</option>
                    <option value="dynamic">Ã‰nergique & YouTuber</option>
                    <option value="emotional">Doux & Narratif</option>
                </select>
            </div>

            <div style="grid-column: span 2; display: flex; gap: 20px; background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px solid var(--border);">
                <div style="flex: 1;">
                    <label style="margin-bottom: 5px;">ğŸµ Musique de Fond (AceStep)</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="checkMusic" checked style="width: 20px; height: 20px;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">GÃ©nÃ©rer une musique d'ambiance instrumentale</span>
                    </div>
                </div>
                <div style="flex: 1;">
                    <label style="margin-bottom: 5px;">ğŸ“ Sous-titres Automatiques</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="checkSubtitles" checked style="width: 20px; height: 20px;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">Incruster les sous-titres (basÃ© sur l'audio)</span>
                    </div>
                </div>
            </div>

            <div>
                <label>â±ï¸ Format</label>
                <select id="durationSelect" style="height: 50px;">
                    <option value="3">Story (15 sec)</option>
                    <option value="5">Reel (25 sec)</option>
                    <option value="8">Short (40 sec)</option>
                </select>
            </div>
        </div>

        <div style="margin-top: 3rem; text-align: right;">
            <button id="nextBtn" class="btn btn-primary" style="padding: 16px 32px; font-size: 1.1rem;" onclick="goNext()">
                GÃ©nÃ©rer le Projet <span style="margin-left:8px">â”</span>
            </button>
        </div>
    </div>
</div>

<script>
    const mode = "{{ mode }}";
    async function goNext() {
        const idea = document.getElementById('idea').value;
        if(!idea) return alert("Une idÃ©e est requise !");

        const btn = document.getElementById('nextBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = "Orchestration IA en cours...";
        btn.disabled = true;

        try {
            const res = await fetch('/api/init', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    idea, 
                    segments: document.getElementById('durationSelect').value,
                    style: document.getElementById('styleSelect').value,
                    camera: document.getElementById('cameraSelect').value,
                    voice_gender: document.getElementById('voiceGenderSelect').value,
                    voice_vibe: document.getElementById('voiceVibeSelect').value,
                    // Nouveaux paramÃ¨tres
                    use_music: document.getElementById('checkMusic').checked,
                    use_subtitles: document.getElementById('checkSubtitles').checked
                })
            });
            if(res.ok) window.location.href = mode === 'oneshot' ? '/process' : '/editor';
        } catch(e) {
            alert("Erreur"); btn.innerHTML = originalText; btn.disabled = false;
        }
    }
</script>
{% endblock %}